<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Breakout Wallet</title>
<style>
body { display: flex; justify-content: center; align-items: center; height: 100vh; background: #f2f2f2; font-family: Arial, sans-serif; }
#wallet-card { background: white; padding: 30px; border-radius: 15px; box-shadow: 0 8px 20px rgba(0,0,0,0.2); text-align: center; width: 400px; }
#wallet-card h2 { margin-bottom: 20px; color: #333; }
#wallet-card input, #wallet-card select { padding: 10px; width: 90%; margin-bottom: 15px; border-radius: 8px; border: 1px solid #ccc; font-size: 16px; }
#wallet-card button { padding: 10px 20px; border: none; border-radius: 8px; background: #28a745; color: white; font-size: 16px; cursor: pointer; margin-bottom: 10px; }
#wallet-card button:hover { background: #218838; }
.payment-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
.copy-btn { margin-left: 10px; padding: 5px 10px; font-size: 12px; cursor: pointer; }
</style>
</head>
<body>

<div id="wallet-card">
  <h2>Breakout Wallet</h2>
  <p id="user-name">User: ...</p>
  <p id="user-balance">Wallet: 0 EGY</p>
  <p id="user-points">Points: 0</p>

  <select id="payment-method">
    <option value="">Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹</option>
    <option value="vodafone">Vodafone Cash</option>
    <option value="instapay">InstaPay</option>
  </select>

  <div id="payment-info" class="payment-info"></div>

  <input type="number" id="payment-amount" placeholder="Enter payment amount (min 100 EGY)" />
  <input type="file" id="payment-proof" accept="image/*" />
  <button id="send-proof-btn">Send Payment Proof</button>
  
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyAubjKdiEqfDpW-tc94-l-AI7lbPs7IU04",
  authDomain: "breakout-d5088.firebaseapp.com",
  projectId: "breakout-d5088",
  storageBucket: "breakout-d5088.appspot.com",
  messagingSenderId: "57071720148",
  appId: "1:57071720148:web:1a628bbb31191d11efcd41"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

// Ø¹Ù†Ø§ØµØ± Ø§Ù„ØµÙØ­Ø©
const userNameEl = document.getElementById("user-name");
const userBalanceEl = document.getElementById("user-balance");
const userPointsEl = document.getElementById("user-points");
const paymentAmountInput = document.getElementById("payment-amount");
const proofInput = document.getElementById("payment-proof");
const paymentMethodSelect = document.getElementById("payment-method");
const sendProofBtn = document.getElementById("send-proof-btn");
const addTestBalanceBtn = document.getElementById("addTestBalanceBtn");
const paymentInfoDiv = document.getElementById("payment-info");

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯ÙØ¹
const vodafoneNumber = "01031133529";
const instaPayEmail = "01060505501";

// ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
async function updateUserDisplay() {
  const user = auth.currentUser;
  if(!user) return;
  const userRef = doc(db,"users",user.uid);
  const userSnap = await getDoc(userRef);
  if(userSnap.exists()){
    const data = userSnap.data();
    userNameEl.textContent = "User: " + data.username;
    userBalanceEl.textContent = "Wallet: " + data.wallet + " EGY";
    userPointsEl.textContent = "Points: " + data.points;
  }
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
auth.onAuthStateChanged(async (user) => {
  if(user) await updateUserDisplay();
  else { alert("âŒ Ù„Ø§Ø²Ù… ØªÙƒÙˆÙ† Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹!"); window.location.href="login.html"; }
});

// ØªØ­Ø¯ÙŠØ« Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹ Ø¹Ù†Ø¯ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
paymentMethodSelect.addEventListener("change", () => {
  const method = paymentMethodSelect.value;
  paymentInfoDiv.innerHTML = "";
  if(method === "vodafone"){
    paymentInfoDiv.innerHTML = `<span id="vodafone-number">${vodafoneNumber}</span><button class="copy-btn" id="copy-vodafone">Copy</button>`;
    document.getElementById("copy-vodafone").onclick = ()=> copyText(vodafoneNumber);
  } else if(method === "instapay"){
    paymentInfoDiv.innerHTML = `<span id="instapay-email">${instaPayEmail}</span><button class="copy-btn" id="copy-instapay">Copy</button>`;
    document.getElementById("copy-instapay").onclick = ()=> copyText(instaPayEmail);
  }
});

// Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø³Ø®
function copyText(text){
  navigator.clipboard.writeText(text).then(()=>alert("âœ… ØªÙ… Ø§Ù„Ù†Ø³Ø®!"));
}

// Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø±ØµÙŠØ¯ Ù„Ù„ØªØ¬Ø±Ø¨Ø©


// Ø²Ø± Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ Ù…Ø¨Ø§Ø´Ø±Ø© Ù„Ù„ØªÙ„ÙŠØ¬Ø±Ø§Ù… Ù…Ø¹ caption
sendProofBtn.addEventListener("click", async () => {
  const user = auth.currentUser;
  if(!user) return alert("âŒ Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù… Ø­Ø§Ù„ÙŠ!");

  const amount = parseInt(paymentAmountInput.value);
  const file = proofInput.files[0];
  const method = paymentMethodSelect.value;

  if(!file) return alert("âŒ Ø§Ø®ØªØ± ØµÙˆØ±Ø© Ø§Ù„Ø¯ÙØ¹ Ø£ÙˆÙ„Ø§Ù‹!");
  if(isNaN(amount) || amount < 50) return alert("âŒ Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ø¯Ù†Ù‰ Ù„Ù„Ø´Ø­Ù† 50 EGY!");
  if(!method) return alert("âŒ Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„Ø¯ÙØ¹!");

  // Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  const userSnap = await getDoc(doc(db,"users",user.uid));
  const email = user.email || "Unknown"; // Ù‡Ù†Ø§ Ù†Ø³ØªØ®Ø¯Ù… email Ù…Ù† Firebase Auth Ù…Ø¨Ø§Ø´Ø±Ø©
  const phone = userSnap.exists() ? userSnap.data().phone || "Unknown" : "Unknown";

  const botToken = "8536551204:AAFpUIBNT7NiDOkC-ZurYhAxWEXcsZ6zzQg";
  const chatId = "8319188377";

  const formData = new FormData();
  formData.append("chat_id", chatId);
  formData.append("photo", file);
  formData.append("caption",` ğŸ’° New Payment Proof\nEmail: ${email}\nPhone: ${phone}\nAmount: ${amount} EGY\nMethod: ${method}`);

  await fetch(`https://api.telegram.org/bot${botToken}/sendPhoto`, {
    method: "POST",
    body: formData
  });

  alert("âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø¥Ø«Ø¨Ø§Øª Ø§Ù„Ø¯ÙØ¹ ÙˆØ³ÙŠØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù‚Ø±ÙŠØ¨Ù‹Ø§.");
  paymentAmountInput.value = "";
  proofInput.value = "";
  paymentMethodSelect.value = "";
  paymentInfoDiv.innerHTMLÂ =Â "";
});


 
</script>
</body>
</html>
