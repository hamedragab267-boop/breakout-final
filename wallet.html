<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Breakout Wallet</title>

<style>
body{
  margin:0;
  min-height:100vh;
  display:flex;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  font-family:'Segoe UI',sans-serif;
  color:#fff;
}
#wallet-card{
  width:420px;
  background:rgba(255,255,255,.12);
  backdrop-filter:blur(15px);
  padding:30px;
  border-radius:20px;
  box-shadow:0 15px 40px rgba(0,0,0,.4);
  text-align:center;
}
#wallet-card h2{color:#00ffcc;margin-bottom:15px;text-shadow:0 0 10px #00ffcc;}
.info{margin:8px 0;font-size:16px;}
#payment-method{width:100%;padding:12px;border-radius:12px;border:2px solid #00ffcc;background:#0f2027;color:#fff;font-size:16px;margin-top:15px;cursor:pointer;}
#payment-method option{background:#203a43;color:#fff;}
#payment-method option[value=""]{color:#aaa;}
#payment-info{margin:15px 0;display:flex;justify-content:center;align-items:center;gap:10px;}
.copy-btn{padding:6px 12px;border:none;border-radius:8px;cursor:pointer;background:#00ffcc;font-weight:bold;}
input[type="number"], input[type="file"]{width:100%;padding:12px;margin-top:10px;border-radius:12px;border:none;outline:none;font-size:15px;}
button{width:100%;margin-top:15px;padding:12px;border:none;border-radius:20px;background:linear-gradient(45deg,#00ffcc,#00d4ff);font-size:16px;font-weight:bold;cursor:pointer;transition:.3s;}
button:hover{transform:scale(1.05);}
#toast{position:fixed;right:25px;bottom:25px;background:linear-gradient(45deg,#00ffcc,#00d4ff);color:#000;padding:14px 22px;border-radius:25px;opacity:0;transition:.4s;font-weight:bold;box-shadow:0 10px 30px rgba(0,255,204,.5);}
#toast.show{opacity:1;}
</style>
</head>
<body>

<div id="toast"></div>

<div id="wallet-card">
  <h2>Breakout Wallet</h2>
  <div class="info" id="user-name">User: ...</div>
  <div class="info" id="user-balance">Wallet: 0 EGY</div>
  <div class="info" id="user-points">Points: 0</div>
  <select id="payment-method">
    <option value="">ÿßÿÆÿ™ÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ</option>
    <option value="vodafone">Vodafone Cash</option>
    <option value="instapay">InstaPay</option>
  </select>
  <div id="payment-info"></div>
  <input type="number" id="amount" placeholder="Amount (min 100 EGY)">
  <input type="file" id="proof" accept="image/*">
  <button id="send">Send Payment Proof</button>
  <button id="logout">Logout</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAubjKdiEqfDpW-tc94-l-AI7lbPs7IU04",
  authDomain: "breakout-d5088.firebaseapp.com",
  projectId: "breakout-d5088",
  storageBucket: "breakout-d5088.appspot.com",
  messagingSenderId: "57071720148",
  appId: "1:57071720148:web:1a628bbb31191d11efcd41"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);

const nameEl = document.getElementById("user-name");
const balanceEl = document.getElementById("user-balance");
const pointsEl = document.getElementById("user-points");
const toast = document.getElementById("toast");
const paymentMethod = document.getElementById("payment-method");
const paymentInfo = document.getElementById("payment-info");
const amountInput = document.getElementById("amount");
const proofInput = document.getElementById("proof");

function showToast(msg){ toast.textContent=msg; toast.classList.add("show"); setTimeout(()=>toast.classList.remove("show"),2500); }

let currentUserEmail = "";
onAuthStateChanged(auth, async user=>{
  if(!user){ location.href="login.html"; return; }
  currentUserEmail = user.email;
  const snap = await getDoc(doc(db,"users",user.uid));
  if(snap.exists()){
    const d=snap.data();
    nameEl.textContent="User: "+d.username;
    balanceEl.textContent="Wallet: "+d.wallet+" EGY";
    pointsEl.textContent="Points: "+d.points;
  }
});

paymentMethod.addEventListener("change",()=>{
  paymentInfo.innerHTML="";
  if(paymentMethod.value==="vodafone"){
    paymentInfo.innerHTML=`<span>01031133529</span><button class="copy-btn">Copy</button>`;
  }
  if(paymentMethod.value==="instapay"){
    paymentInfo.innerHTML=`<span>01060505501</span><button class="copy-btn">Copy</button>`;
  }
  const btn=paymentInfo.querySelector("button");
  if(btn){ btn.onclick=()=>navigator.clipboard.writeText(paymentInfo.querySelector("span").textContent).then(()=>showToast("Copied ‚úÖ")); }
});

// ÿ•ÿ±ÿ≥ÿßŸÑ ÿßŸÑÿµŸàÿ±ÿ© ŸÖÿ®ÿßÿ¥ÿ±ÿ© ŸÑŸÑÿ™ŸÑÿ¨ÿ±ÿßŸÖ ÿ®ÿØŸàŸÜ ÿ™ÿÆÿ≤ŸäŸÜ
document.getElementById("send").onclick=async ()=>{
  const method = paymentMethod.value;
  const amount = amountInput.value.trim();
  const file = proofInput.files[0];

  if(!method){ showToast("ÿßÿÆÿ™ÿ± ÿ∑ÿ±ŸäŸÇÿ© ÿßŸÑÿØŸÅÿπ!"); return; }
  if(!amount || parseInt(amount)<100){ showToast("ÿ£ÿØÿÆŸÑ ŸÖÿ®ŸÑÿ∫ ÿµÿ≠Ÿäÿ≠ (‚â•100)"); return; }
  if(!file){ showToast("ÿßÿÆÿ™ÿ± ÿµŸàÿ±ÿ© ÿßŸÑÿ•ÿ´ÿ®ÿßÿ™!"); return; }

  showToast("Uploading... ‚è≥");

  try{
    // ÿ™ÿ≠ŸàŸäŸÑ ÿßŸÑÿµŸàÿ±ÿ© ÿ•ŸÑŸâ Blob
    const formData = new FormData();
    formData.append("chat_id", "8319188377");
    formData.append("photo", file);
    formData.append("caption", `üí∞ New Wallet Payment\nUser: ${currentUserEmail}\nAmount: ${amount} EGY\nMethod: ${method}`);

    const botToken = "8536551204:AAFpUIBNT7NiDOkC-ZurYhAxWEXcsZ6zzQg";
    const url = `https://api.telegram.org/bot${botToken}/sendPhoto`;
    await fetch(url, { method:"POST", body: formData });

    showToast("Payment proof sent ‚úîÔ∏è");
  }catch(e){
    console.error(e);
    showToast("Failed ‚ùå");
  }
};

document.getElementById("logout").onclick=()=>{ signOut(auth).then(()=>{ showToast("Logged out"); setTimeout(()=>location.href="login.html",1000); }); };
</script>

</body>
</html>
