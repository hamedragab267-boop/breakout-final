<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hot Drinks - Breakout</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  overflow-x:hidden;
}
#toast{
  position:fixed;
  bottom:30px;
  right:30px;
  background:linear-gradient(45deg,#00ffcc,#00d4ff);
  color:#000;
  padding:12px 25px;
  border-radius:25px;
  opacity:0;
  transition:.4s;
  font-weight:bold;
  z-index:2000;
}
#toast.show{opacity:1;}
/* ===== USER CARD ===== */
#user-card{
  position:fixed;
  top:20px;
  right:20px;
  width:220px;
  padding:15px;
  backdrop-filter:blur(12px);
  background:rgba(255,255,255,.12);
  border-radius:15px;
  text-align:center;
  z-index:1000;
}
#user-card h5,#user-card p{margin:5px 0;}
.user-buttons{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
}
.user-buttons button{
  padding:5px 12px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
}
#home-btn{background:linear-gradient(45deg,#00ffcc,#00d4ff);color:#000;}
#cart-btn{background:linear-gradient(45deg,#ffcc00,#ffaa00);color:#000;position:relative;}
#cart-count{
  position:absolute;
  top:-8px;
  right:-8px;
  background:#ff4d4d;
  color:#fff;
  width:20px;height:20px;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:0.75rem;font-weight:bold;
}
/* ===== Drinks Header ===== */
.drinks-header{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:15px;
  margin-top:120px;
  flex-wrap:wrap;
}
.drinks-header h2{
  color:#00ffcc;
  font-size:2rem;
  font-weight:bold;
  text-shadow:0 0 5px #00ffcc;
}
.drinks-header p{
  color:#fff;
  font-size:1.2rem;
  margin:0;
}
.drinks-header img{
  width:50px;
  height:50px;
  border-radius:10px;
  object-fit:cover;
}
/* ===== DRINK CARDS ===== */
.container-cards{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:20px;
  margin:30px 10px 50px;
}
.card-drink{
  width:200px;
  background:linear-gradient(145deg,#111,#222);
  border:2px solid #00ffcc;
  border-radius:20px;
  padding:10px;
  box-shadow:0 8px 20px rgba(0,255,204,.3);
}
.card-drink img{
  width:100%;height:150px;border-radius:15px;margin-bottom:10px;object-fit:cover;
}
.card-drink h5{text-align:center;color:#00ffcc;margin-bottom:8px;}
.card-drink input,.card-drink select{
  width:100%;margin-bottom:8px;padding:5px;border-radius:8px;border:none;
}
.card-drink button{
  width:100%;padding:8px;border:none;border-radius:12px;
  background:linear-gradient(45deg,#00ffcc,#00d4ff);
  font-weight:bold;cursor:pointer;
}
.drink-price{text-align:center;font-weight:bold;color:#ffcc00;font-size:1.1rem;margin-bottom:3px;text-shadow:0 0 5px #ffcc00,0 0 10px #ff9900;}
.drink-points{text-align:center;font-weight:bold;color:#00ffcc;margin-bottom:5px;}
</style>
</head>
<body>

<div id="toast"></div>

<!-- User Card -->
<div id="user-card">
  <h5 id="user-name">Loading...</h5>
  <p id="user-balance"></p>
  <p id="user-points"></p>
  <div class="user-buttons">
    <button id="home-btn" onclick="location.href='../home.html'">Home</button>
    <button id="cart-btn" onclick="location.href='../cart.html'">
      Cart üõí <span id="cart-count">0</span>
    </button>
  </div>
</div>

<!-- Drinks Header -->
<div class="drinks-header">
  <h2>Hot Drinks</h2>
</div>

<!-- Drinks Container -->
<div class="container-cards" id="drinks-container"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAubjKdiEqfDpW-tc94-l-AI7lbPs7IU04",
  authDomain:"breakout-d5088.firebaseapp.com",
  projectId:"breakout-d5088"
});

const auth=firebase.auth();
const db=firebase.firestore();

/* Toast */
function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

/* User Card */
const nameEl=document.getElementById("user-name");
const balEl=document.getElementById("user-balance");
const ptsEl=document.getElementById("user-points");
const cartCountEl=document.getElementById("cart-count");

auth.onAuthStateChanged(user=>{
  if(!user){location.href="login.html";return;}
  const ref=db.collection("users").doc(user.uid);

  ref.onSnapshot(doc=>{
    if(!doc.exists) return;
    const d=doc.data();
    nameEl.textContent="User: "+d.username;
    balEl.textContent="Wallet: "+d.wallet+" EGY";
    ptsEl.textContent="Points: "+d.points;
    cartCountEl.textContent=(d.cart||[]).length;
  });
});

/* Drinks Data */
const drinks=[
  {name:"Tea",img:"img/tea.jpg",flavors:[
    {name:"ÿ≥ÿßÿØÿ©",price:10,points:5},
    {name:"ŸÜÿπŸÜÿßÿπ",price:10,points:5},
    {name:"ÿ≠ŸÑŸäÿ® ÿ£ÿÆÿ∂ÿ±",price:10,points:5},
    {name:"ŸÑŸäŸÖŸàŸÜ",price:10,points:5},
    {name:"ÿ≠ŸÑŸäÿ®",price:10,points:5}
  ]},
  {name:"Turkish Coffee",img:"img/turky coffe.jpg",flavors:[
    {name:"ÿ≥ŸäŸÜÿ¨ŸÑ ÿ≥ÿßÿØÿ©",price:25,points:10},
    {name:"ÿ≥ŸäŸÜÿ¨ŸÑ ŸÖÿ≠Ÿàÿ¨",price:25,points:10},
    {name:"ÿØÿ®ŸÑ ÿ≥ÿßÿØÿ©",price:35,points:15},
    {name:"ÿØÿ®ŸÑ ŸÖÿ≠Ÿàÿ¨",price:35,points:15}
  ]},
  {name:"French Coffee",img:"img/french coffe.jpg",flavors:[
    {name:"ÿ≥ŸäŸÜÿ¨ŸÑ ÿ≥ÿßÿØÿ©",price:30,points:10},
    {name:"ÿ≥ÿ®ŸÜÿ¨ŸÑ ŸÖÿ≠Ÿàÿ¨",price:30,points:10},
    {name:"ÿØÿ®ŸÑ ÿ≥ÿßÿØÿ©",price:45,points:15},
    {name:"ÿØÿ®ŸÑ ŸÖÿ≠Ÿàÿ¨",price:45,points:15}
  ]},
  {name:"Hazelnut Coffee",img:"img/ÿ®ŸÜÿØŸÇ.jpg",flavors:[
    {name:"ÿ≥ŸäŸÜÿ¨ŸÑ",price:30,points:10},
    {name:"ÿØÿ®ŸÑ",price:45,points:15}
  ]},
  {name:"Mint",img:"img/ŸÜÿπŸÜÿßÿπ.png",flavors:[
    {name:"ÿ≥ÿßÿØÿ©",price:10,points:5}
  ]},
  {name:"Anise Tea",img:"img/ŸäŸÜÿ≥ŸàŸÜ.jpg",flavors:[
    {name:"ÿ≥ÿßÿØÿ©",price:10,points:5},
    {name:"ŸÑŸäŸÖŸàŸÜ",price:15,points:5}
  ]},
  {name:"Hibiscus",img:"img/ŸÉÿ±ŸÉÿØŸäŸá.jpg",flavors:[
    {name:"ÿ≥ÿßÿØÿ©",price:10,points:5}
  ]},
  {name:"Espresso",img:"img/ÿßÿ≥ÿ®ÿ±ÿ≥Ÿà.jpg",flavors:[
    {name:"ÿ≥ŸäŸÜÿ¨ŸÑ",price:35,points:15},
    {name:"ÿØÿ®ŸÑ",price:45,points:20}
  ]},
  {name:"Nescafe Gold",img:"img/gold.jpg",flavors:[
    {name:"ŸÉÿßÿ®ÿ™ÿ¥ŸäŸÜŸà",price:30,points:20},
    {name:"ŸÑÿßÿ™ŸäŸá",price:30,points:20},
    {name:"ŸÅÿßŸÜŸäŸÑŸäÿß",price:30,points:20},
    {name:"ŸÖŸàŸÉÿß",price:30,points:20},
    {name:"ŸÉÿ±ÿßŸÖŸäŸÑ",price:30,points:20},
    {name:"ŸÉÿßÿ®ÿ™ÿ¥ŸäŸÜŸà ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:20,points:15},
    {name:"ŸÑÿßÿ™ŸäŸá ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:20,points:15},
    {name:"ŸÅÿßŸÜŸäŸÑŸäÿß ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:20,points:15},
    {name:"ŸÖŸàŸÉÿß ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:20,points:15},
    {name:"ŸÉÿ±ÿßŸÖŸäŸÑ ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:20,points:15}
  ]},
  {name:"Bonjorno",img:"img/images.jpg",flavors:[
    {name:"ŸÑÿßÿ™ŸäŸá",price:30,points:20},
    {name:"ŸÖŸàŸÉÿß",price:30,points:20},
    {name:"ŸÑÿßÿ™ŸäŸá ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:20,points:15},
    {name:"ŸÖŸàŸÉÿß ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:20,points:15}
  ]},
  {name:"Nescafe 3x1",img:"img/nes3x1.jpg",flavors:[
    {name:"ÿ≥ÿßÿØÿ©",price:30,points:20},
    {name:"ÿ¥ŸäŸÉŸàŸÑÿßÿ™ÿ©",price:30,points:20},
    {name:"ÿ®ŸÜÿØŸÇ",price:30,points:20},
    {name:"ŸÉÿ±ÿßŸÖŸäŸÑ",price:30,points:20},
    {name:"ÿ≥ÿßÿØÿ© ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:15,points:15},
    {name:"ÿ¥ŸäŸÉŸàŸÑÿßÿ™ÿ© ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:15,points:15},
    {name:"ÿ®ŸÜÿØŸÇ ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:15,points:15},
    {name:"ŸÉÿ±ÿßŸÖŸäŸÑ ÿ®ÿØŸàŸÜ ÿ≠ŸÑŸäÿ®",price:15,points:15}
  ]},
  {name:"Nescafe Black",img:"img/ŸÜÿ≥ŸÉÿßŸÅŸäŸá.jpeg",flavors:[
    {name:"ŸÖÿπ ÿ≠ŸÑŸäÿ®",price:30,points:20},
    {name:"ÿ≥ÿßÿØÿ©",price:15,points:10}
  ]},
  {name:"Hot Chocolate",img:"img/hot choclet.jpg",flavors:[
    {name:"ŸÖÿπ ÿ≠ŸÑŸäÿ®",price:30,points:5},
    {name:"ÿ≥ÿßÿØÿ©",price:20,points:5}
  ]},
  {name:"Sahlab",img:"img/ÿßŸÑÿ≥ÿ≠ŸÑÿ®-600x470.jpg",flavors:[
    {name:"ÿ≥ÿßÿØÿ©",price:35,points:20}
  ]},
  {name:"Cinnamon Tea",img:"img/ŸÇÿ±ŸÅÿ©.jpg",flavors:[
    {name:"ÿ≥ÿßÿØÿ©",price:10,points:5},
    {name:"ŸÖÿπ ÿ≠ŸÑŸäÿ®",price:15,points:10}
  ]},
  {name:"Water",img:"img/water.png",flavors:[
    {name:"ÿ®ÿßÿ±ÿØÿ©",price:7,points:0},
    {name:"ÿ≥ÿßÿÆŸÜÿ©",price:7,points:0}
  ]}
];


const container=document.getElementById("drinks-container");
const requireSugar = ["Turkish Coffee","French Coffee","Hazelnut Coffee"];

drinks.forEach(drink=>{
  const div=document.createElement("div");
  div.className="card-drink";

  const defaultPrice = drink.flavors[0].price;
  const defaultPoints = drink.flavors[0].points;

  div.innerHTML=`
    <img src="${drink.img}">
    <p class="drink-price">${defaultPrice} EGY</p>
    <p class="drink-points">${defaultPoints} Points</p>
    <h5>${drink.name}</h5>
    <input type="number" class="qty" value="1" min="1">
    <select class="flavor">
      ${drink.flavors.map(f=>`<option data-price="${f.price}" data-points="${f.points}">${f.name}</option>`).join("")}
    </select>
    <input type="text" class="notes" placeholder="Notes">
    <button>Add to Cart</button>
  `;
  container.appendChild(div);

  const priceEl = div.querySelector(".drink-price");
  const pointsEl = div.querySelector(".drink-points");
  const flavorSelect = div.querySelector(".flavor");
  const qtyInput = div.querySelector(".qty");

  function updatePriceAndPoints(){
    const selectedOption = flavorSelect.options[flavorSelect.selectedIndex];
    const qty = +qtyInput.value || 1;
    priceEl.textContent = (selectedOption.dataset.price * qty) + " EGY";
    pointsEl.textContent = (selectedOption.dataset.points * qty) + " Points";
  }

  flavorSelect.onchange = updatePriceAndPoints;
  qtyInput.oninput = updatePriceAndPoints;

  div.querySelector("button").onclick=async()=>{
    const qty=+qtyInput.value;
    const opt=flavorSelect.options[flavorSelect.selectedIndex];
    const price=opt.dataset.price*qty;
    const points=opt.dataset.points*qty;
    const flavor=opt.textContent;
    const notes=div.querySelector(".notes").value.trim();

    if(requireSugar.includes(drink.name) && notes===""){
      showToast("‚ö†Ô∏è Please enter sugar before adding to cart!");
      return;
    }

    const user=auth.currentUser;
    const ref=db.collection("users").doc(user.uid);
    const snap=await ref.get();
    const cart=snap.data().cart||[];

    cart.push({name:drink.name,flavor,qty,notes,totalPrice:price,points});
    await ref.update({cart});
    showToast("Added to cart üõí");
  };
});
</script>

</body>
</html>