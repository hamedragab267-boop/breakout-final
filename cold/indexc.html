<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cold Drinks - Breakout</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
<style>
body{
  margin:0;
  font-family:'Segoe UI',sans-serif;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  color:#fff;
  overflow-x:hidden;
}
#toast{
  position:fixed;
  bottom:30px;
  right:30px;
  background:linear-gradient(45deg,#00ffcc,#00d4ff);
  color:#000;
  padding:12px 25px;
  border-radius:25px;
  opacity:0;
  transition:.4s;
  font-weight:bold;
  z-index:2000;
}
#toast.show{opacity:1;}
/* ===== USER CARD ===== */
#user-card{
  position:fixed;
  top:20px;
  right:20px;
  width:220px;
  padding:15px;
  backdrop-filter:blur(12px);
  background:rgba(255,255,255,.12);
  border-radius:15px;
  box-shadow:0 12px 40px rgba(0,0,0,.45);
  text-align:center;
  z-index:1000;
}
#user-card h5,#user-card p{margin:5px 0;}
.user-buttons{
  display:flex;
  justify-content:space-between;
  margin-top:10px;
}
.user-buttons button{
  padding:5px 12px;
  border:none;
  border-radius:12px;
  font-weight:bold;
  cursor:pointer;
}
#home-btn{background:linear-gradient(45deg,#00ffcc,#00d4ff);color:#000;}
#cart-btn{background:linear-gradient(45deg,#ffcc00,#ffaa00);color:#000;position:relative;}
#cart-count{
  position:absolute;
  top:-8px;
  right:-8px;
  background:#ff4d4d;
  color:#fff;
  width:20px;height:20px;
  border-radius:50%;
  display:flex;align-items:center;justify-content:center;
  font-size:0.75rem;font-weight:bold;
}
/* ===== Drinks Header ===== */
.drinks-header{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:15px;
  margin-top:120px;
  flex-wrap:wrap;
}
.drinks-header h2{
  color:#00ffcc;
  font-size:2rem;
  font-weight:bold;
  text-shadow:0 0 5px #00ffcc;
}
.drinks-header p{
  color:#fff;
  font-size:1.2rem;
  margin:0;
}
.drinks-header img{
  width:50px;
  height:50px;
  border-radius:10px;
  object-fit:cover;
}
/* ===== DRINK CARDS ===== */
.container-cards{
  display:flex;
  flex-wrap:wrap;
  justify-content:center;
  gap:20px;
  margin:30px 10px 50px;
}
.card-drink{
  width:200px;
  background:linear-gradient(145deg,#111,#222);
  border:2px solid #00ffcc;
  border-radius:20px;
  padding:10px;
  box-shadow:0 8px 20px rgba(0,255,204,.3);
}
.card-drink img{
  width:100%;height:150px;border-radius:15px;margin-bottom:10px;object-fit:cover;
}
.card-drink h5{text-align:center;color:#00ffcc;margin-bottom:8px;}
.card-drink input,.card-drink select{
  width:100%;margin-bottom:8px;padding:5px;border-radius:8px;border:none;
}
.card-drink button{
  width:100%;padding:8px;border:none;border-radius:12px;
  background:linear-gradient(45deg,#00ffcc,#00d4ff);
  font-weight:bold;cursor:pointer;
}
.drink-price{text-align:center;font-weight:bold;color:#ffcc00;font-size:1.1rem;margin-bottom:3px;text-shadow:0 0 5px #ffcc00,0 0 10px #ff9900;}
.drink-points{text-align:center;font-weight:bold;color:#00ffcc;margin-bottom:5px;}
</style>
</head>
<body>

<div id="toast"></div>

<!-- User Card -->
<div id="user-card">
  <h5 id="user-name">Loading...</h5>
  <p id="user-balance"></p>
  <p id="user-points"></p>
  <div class="user-buttons">
    <button id="home-btn" onclick="location.href='../home.html'">Home</button>
    <button id="cart-btn" onclick="location.href='../cart.html'">
      Cart ðŸ›’ <span id="cart-count">0</span>
    </button>
  </div>
</div>

<!-- Drinks Header -->
<div class="drinks-header">
  
  <h2>Cold Drinks</h2>
  
</div>

<!-- Drinks Container -->
<div class="container-cards" id="drinks-container"></div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
firebase.initializeApp({
  apiKey:"AIzaSyAubjKdiEqfDpW-tc94-l-AI7lbPs7IU04",
  authDomain:"breakout-d5088.firebaseapp.com",
  projectId:"breakout-d5088"
});

const auth=firebase.auth();
const db=firebase.firestore();

/* Toast */
function showToast(msg){
  const t=document.getElementById("toast");
  t.textContent=msg;
  t.classList.add("show");
  setTimeout(()=>t.classList.remove("show"),2000);
}

/* User Card */
const nameEl=document.getElementById("user-name");
const balEl=document.getElementById("user-balance");
const ptsEl=document.getElementById("user-points");
const cartCountEl=document.getElementById("cart-count");

auth.onAuthStateChanged(user=>{
  if(!user){location.href="login.html";return;}
  const ref=db.collection("users").doc(user.uid);

  ref.onSnapshot(doc=>{
    if(!doc.exists) return;
    const d=doc.data();
    nameEl.textContent="User: "+d.username;
    balEl.textContent="Wallet: "+d.wallet+" EGY";
    ptsEl.textContent="Points: "+d.points;
    cartCountEl.textContent=(d.cart||[]).length;
  });
});

/* Cold Drinks Data */
const drinks=[
  {name:"Milkshakes",img:"img/Ù…ÙŠÙ„Ùƒ Ø´ÙŠÙƒ.jpg",flavors:[
    {name:"ÙØ§Ù†ÙŠÙ„ÙŠØ§",price:40,points:30},
    {name:"ÙƒØ§Ø±Ù…ÙŠÙ„",price:40,points:30},
    {name:"Ø´ÙˆÙƒÙ„Ø§ØªÙ‡",price:40,points:30},
    {name:"Ø§ÙˆØ±ÙŠÙˆ",price:50,points:50},
    {name:"ØªÙˆÙŠÙ†ÙƒØ²",price:50,points:50},
    {name:"Ù‡ÙˆÙ‡ÙˆØ²",price:50,points:50}
  ]},
  {name:"Frappe",img:"img/GoodFoodFrappe-8757348.jpg",flavors:[
    {name:"ÙƒØ§Ø±Ù…ÙŠÙ„",price:40,points:30},
    {name:"Ø´ÙˆÙƒÙ„Ø§ØªÙ‡",price:40,points:30},
    {name:"Ø³Ø§Ø¯Ø©",price:40,points:30},
    {name:"Ù„Ø§ØªÙŠÙ‡ ÙƒØ§Ø±Ù…ÙŠÙ„",price:40,points:30},
    {name:"Ù…ÙˆÙƒØ§ Ø´ÙˆÙƒÙ„Ø§ØªÙ‡",price:40,points:30},
    {name:"Ø¨Ù†Ø¯Ù‚",price:40,points:30}
  ]},
  {name:"Iced Coffee",img:"img/Caramel-Iced-Coffee-6.jpg",flavors:[
    {name:"ÙƒØ§Ø±Ù…ÙŠÙ„",price:40,points:30},
    {name:"Ø´ÙˆÙƒÙ„Ø§ØªÙ‡",price:40,points:30},
    {name:"Ø³Ø§Ø¯Ø©",price:40,points:30},
    {name:"Ù„Ø§ØªÙŠÙ‡ ÙƒØ§Ø±Ù…ÙŠÙ„",price:40,points:30},
    {name:"Ù…ÙˆÙƒØ§ Ø´ÙˆÙƒÙ„Ø§ØªÙ‡",price:40,points:30},
    {name:"Ø¨Ù†Ø¯Ù‚",price:40,points:30}
  ]},
  {name:"Lemonade",img:"img/healthy-lemonade.jpg",flavors:[
    {name:"Ø³Ø§Ø¯Ø©",price:20,points:15},
    {name:"Ù†Ø¹Ù†Ø§Ø¹",price:20,points:15},
    {name:"Ø¨Ø§Ù„Ø­Ù„ÙŠØ¨",price:25,points:20}
  ]},
  {name:"Orange Juice",img:"img/orange-juice-for-health.jpg",flavors:[
    {name:"Ø³Ø§Ø¯Ø©",price:35,points:20},
    {name:"Smoothie",price:40,points:25}
  ]},
  {name:"Mango Juice",img:"img/mango.jpg",flavors:[
    {name:"Ø³Ø§Ø¯Ø©",price:35,points:20},
    {name:"Smoothie",price:40,points:25}
  ]},
  {name:"Strawberry Juice",img:"img/st.jpg",flavors:[
    {name:"Ø³Ø§Ø¯Ø©",price:25,points:15},
    {name:"Smoothie",price:40,points:20}
  ]},
  {name:"Banana Juice",img:"img/banana.jpg",flavors:[
    {name:"Ø³Ø§Ø¯Ø©",price:25,points:15}
  ]},
  {name:"Berry Juice",img:"img/ØªÙˆØª.jpg",flavors:[
    {name:"Ø³Ø§Ø¯Ø©",price:40,points:20}
  ]},
  {name:"Pineapple Juice",img:"img/Ø§Ù†Ø§Ù†Ø³.jpg",flavors:[
    {name:"Ø³Ø§Ø¯Ø©",price:40,points:20}
  ]},
  {name:"Sun Shine",img:"img/ØµÙ†.jpg",flavors:[
    {name:"Ø±Ù…Ø§Ù†",price:30,points:15},
    {name:"ÙØ±Ø§ÙˆÙ„Ø©",price:30,points:15},
    {name:"ØªÙˆØª",price:30,points:15},
    {name:"Ø§Ù†Ø§Ù†Ø§Ø³",price:30,points:15},
    {name:"ÙƒØ±ÙŠØ²",price:30,points:15},
    {name:"Ù„Ù…ÙˆÙ† Ù†Ø¹Ù†Ø§Ø¹",price:30,points:15}
  ]},
  {name:"Cherry Cola",img:"img/Ø´ÙŠØ±ÙŠ.jpg",flavors:[
    {name:"Ø±Ù…Ø§Ù†",price:30,points:15},
    {name:"ÙØ±Ø§ÙˆÙ„Ø©",price:30,points:15},
    {name:"ØªÙˆØª",price:30,points:15},
    {name:"Ø§Ù†Ø§Ù†Ø§Ø³",price:30,points:15},
    {name:"ÙƒØ±ÙŠØ²",price:30,points:15}
  ]},
  {name:"Matcha",img:"img/Photoroom-20241122_094451_5.png",flavors:[
    {name:"Iced",price:50,points:25},
    {name:"Frappe",price:50,points:25}
  ]},
  {name:"Soft Drink",img:"img/Ø³ÙŠÙÙ†.png",flavors:[
    {name:"Ø³ÙŠÙÙ†",price:15,points:5},
    {name:"Ø¨ÙŠØ¨Ø³ÙŠ",price:15,points:5}
  ]}
];

const container=document.getElementById("drinks-container");

drinks.forEach(drink=>{
  const div=document.createElement("div");
  div.className="card-drink";

  const defaultPrice = drink.flavors[0].price;
  const defaultPoints = drink.flavors[0].points;

  div.innerHTML=`
    <img src="${drink.img}">
    <p class="drink-price">${defaultPrice} EGY</p>
    <p class="drink-points">${defaultPoints} Points</p>
    <h5>${drink.name}</h5>
    <input type="number" class="qty" value="1" min="1">
    <select class="flavor">
      ${drink.flavors.map(f=>`<option data-price="${f.price}" data-points="${f.points}">${f.name}</option>`).join("")}
    </select>
    <input type="text" class="notes" placeholder="Notes">
    <button>Add to Cart</button>
  `;
  container.appendChild(div);

  const priceEl = div.querySelector(".drink-price");
  const pointsEl = div.querySelector(".drink-points");
  const flavorSelect = div.querySelector(".flavor");
  const qtyInput = div.querySelector(".qty");

  function updatePriceAndPoints(){
    const selectedOption = flavorSelect.options[flavorSelect.selectedIndex];
    const qty = +qtyInput.value || 1;
    priceEl.textContent = (selectedOption.dataset.price * qty) + " EGY";
    pointsEl.textContent = (selectedOption.dataset.points * qty) + " Points";
  }

  flavorSelect.onchange = updatePriceAndPoints;
  qtyInput.oninput = updatePriceAndPoints;

  div.querySelector("button").onclick=async()=>{
    const qty=+qtyInput.value;
    const opt=flavorSelect.options[flavorSelect.selectedIndex];
    const price=opt.dataset.price*qty;
    const points=opt.dataset.points*qty;
    const flavor=opt.textContent;
    const notes=div.querySelector(".notes").value;

    const user=auth.currentUser;
    const ref=db.collection("users").doc(user.uid);
    const snap=await ref.get();
    const cart=snap.data().cart||[];

    cart.push({name:drink.name,flavor,qty,notes,totalPrice:price,points});
    await ref.update({cart});
    showToast("Added to cart ðŸ›’");
  };
});
</script>

</body>
</html>
